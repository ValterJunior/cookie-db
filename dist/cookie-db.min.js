function CookieTable(t){this.name=t,this.fields=[],this.values=[],this.row={},this.recNo=1,this._lastRecNo=1,this.active=!1,this.PREFIX_NAME="ct_",this.recNoIsValid=function(){return this.recNo>=1&&this.recNo<=this.values.length},this.setEmptyRow=function(){this.row={};for(var t in this.fields)this.row[this.fields[t].name]=null},this.processRow=function(){switch(this.state){case ctStates.INSERT:this.recNo=this.values.length+1,this.setEmptyRow();break;case ctStates.EDIT:case ctStates.BROWSE:if(this.recNoIsValid()){this.convertTypes(),this.setEmptyRow();for(var t in this.fields)this.row[this.fields[t].name]=this.values[this.recNo-1][this.fields[t].name]}}},this.arrayEscape=function(t){for(var e in t)for(var s in t[e])t[e][s]=escape(t[e][s]);return t},this.arrayUnescape=function(t){for(var e in t)for(var s in t[e])t[e][s]=unescape(t[e][s]);return t},this.resetData=function(){this.values=[],this.recNo=1,this._lastRecNo=1,this.setEmptyRow()},this.convertTypes=function(){for(var t in this.values)for(var e in this.fields)switch(Number(this.fields[e].type)){case ctFieldTypes.NUMBER:this.values[t][this.fields[e].name]=Number(this.values[t][this.fields[e].name]);break;case ctFieldTypes.STRING:this.values[t][this.fields[e].name]=String(this.values[t][this.fields[e].name]);break;case ctFieldTypes.BOOL:this.values[t][this.fields[e].name]="true"===String(this.values[t][this.fields[e].name])}},this.fromJSON=function(t){try{this.resetData(),t.fields&&t.fields.length>0&&(this.fields=this.arrayUnescape(t.fields)),t.values&&t.values.length>0&&(this.values=this.arrayUnescape(t.values)),this.convertTypes()}catch(e){throw"JSON does not match"}},this.toJSON=function(){return{fields:this.arrayEscape(this.fields),values:this.arrayEscape(this.values)}},this.resetData()}var ctStates={INSERT:0,EDIT:1,BROWSE:2,DELETE:3},ctFieldTypes={NUMBER:0,STRING:1,BOOL:2};CookieTable.prototype.isActive=function(){return this.active},CookieTable.prototype.exists=function(){return this.isActive()&&this.fields&&this.fields.length>0&&this.values},CookieTable.prototype.open=function(){return this.active||(this.start(),this.active=!0),this},CookieTable.prototype.close=function(){this.active&&(this.commit(),this.active=!1,this.resetData())},CookieTable.prototype.addField=function(t,e){return this.active||this.fields.push({name:t,type:e}),this},CookieTable.prototype.append=function(){return this.active&&(this.state=ctStates.INSERT,this.processRow()),this},CookieTable.prototype.edit=function(){return this.active&&(this.state=ctStates.EDIT,this.processRow()),this},CookieTable.prototype.getRow=function(){return this.row},CookieTable.prototype.goTo=function(t){return this.active&&(this._lastRecNo=this.recNo,this.recNo=t,this.recNoIsValid()?(this.state=ctStates.BROWSE,this._lastRecNo=this.recNo,this.processRow()):this.recNo=this._lastRecNo),this},CookieTable.prototype.locate=function(t,e,s){var i="[object Array]"===Object.prototype.toString.call(t),o="[object Array]"===Object.prototype.toString.call(e);if(isNull(t)||isNull(e))throw"Fields and values must be informed";if(i&&!o||!i&&o)throw"Fields and values do not match";if(i&&t.length!==e.length)throw"The amount of fields and values must be the same";isNull(s)&&(s=!1);for(var r in this.values){var a=this.values[r];if(i){var h=!0,n="string"==typeof a[t[c]]&&"string"==typeof e[c];for(var c in t)if(h=h&&(n&&!s?String(a[t[c]]).toLowerCase()===String(e[c]).toLowerCase():a[t[c]]===e[c]),!h)return!1;return this.goTo(Number(r)+1),!0}var n="string"==typeof a[t]&&"string"==typeof e;if(n&&!s?String(a[t]).toLowerCase()===String(e).toLowerCase():String(a[t])===String(e))return this.goTo(Number(r)+1),!0}},CookieTable.prototype.post=function(){if(this.active){switch(this.state){case ctStates.INSERT:this.values.push(this.row),this.goTo(this.count());break;case ctStates.EDIT:this.values[this.recNo-1]=this.row,this.goTo(this.recNo);break;case ctStates.DELETE:this.values.splice(this.recNo-1,1),this.goTo(this.recNo-1)}this._lastRecNo=this.recNo}return this},CookieTable.prototype["delete"]=function(){return this.active&&this.state===ctStates.BROWSE?this.state=ctStates.DELETE:this.cancel(),this},CookieTable.prototype.truncate=function(){return $.removeCookie(this.PREFIX_NAME+this.name),this.start(),this},CookieTable.prototype.cancel=function(){return this.active&&(this.recNo=this._lastRecNo,this.processRow()),this},CookieTable.prototype.count=function(){return this.values.length},CookieTable.prototype.first=function(){return this.goTo(1)},CookieTable.prototype.last=function(){return this.goTo(this.count())},CookieTable.prototype.prior=function(){return this.recNo>1?this.goTo(this.recNo-1):1===this.recNo&&(this.recNo-=1,this.setEmptyRow()),this},CookieTable.prototype.next=function(){return this.recNo<this.count()?this.goTo(this.recNo+1):this.recNo===this.count()&&(this.recNo+=1,this.setEmptyRow()),this},CookieTable.prototype.isBOF=function(){return this.recNo<1},CookieTable.prototype.isEOF=function(){return this.recNo>this.count()},CookieTable.prototype.start=function(){$.cookie.json=!0;var t=$.cookie(this.PREFIX_NAME+this.name);return this.resetData(),t&&this.fromJSON(t),this.state=ctStates.BROWSE,this},CookieTable.prototype.commit=function(){return this.active&&($.cookie.json=!0,$.cookie(this.PREFIX_NAME+this.name,this.toJSON(),{path:"/"}),this.state=ctStates.BROWSE),this},CookieTable.prototype.rollback=function(){return this.active&&this.start(),this};